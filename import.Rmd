---
title: "dynaref import"
author: "Adrien Fabre"
date: "March 23, 2018"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

package <- function(p) { 
  if (!is.element(p, installed.packages()[,1])) {
    install.packages(p); 
  }
  library(p, character.only = TRUE)
} # loads packages with automatical install if needed
package("readxl")

setwd("/var/www/dynaresf")

import_detail <- function() {
  pop_future_detail <- read_xls("future population francaise par age - INSEE.xls", sheet=2, col_names=FALSE)[-(1:4),]
  pop_future_detail[1,1] <- "age"
  colnames(pop_future_detail) <- pop_future_detail[1,]
  pop_future_detail <- pop_future_detail[-1,]  
  
  pop_future_f_detail <- read_xls("future population francaise par age - INSEE.xls", sheet=3, col_names=FALSE)[-(1:4),]
  pop_future_f_detail[1,1] <- "age"
  colnames(pop_future_f_detail) <- pop_future_f_detail[1,]
  pop_future_f_detail <- pop_future_f_detail[-1,]
  
    
  pop_future_h_detail <- read_xls("future population francaise par age - INSEE.xls", sheet=4, col_names=FALSE)[-(1:4),]
  pop_future_h_detail[1,1] <- "age"
  colnames(pop_future_h_detail) <- pop_future_h_detail[1,]
  pop_future_h_detail <- pop_future_h_detail[-1,]
  
  pop_future <- as.data.frame(seq(2013,2070,1))
  names(pop_future) <- c("an")
  
  for (i in pop_future$an)    {
    pop_future$tot15_24[pop_future$an==i] <- sum(pop_future_detail[16:25,as.character(i)])
    pop_future$tot25_54[pop_future$an==i] <- sum(pop_future_detail[26:55,as.character(i)])
    pop_future$tot55_[pop_future$an==i] <- sum(pop_future_detail[56:109,as.character(i)])
    
    pop_future$f15_24[pop_future$an==i] <- sum(pop_future_f_detail[16:25,as.character(i)])
    pop_future$f25_54[pop_future$an==i] <- sum(pop_future_f_detail[26:55,as.character(i)])
    pop_future$f55_[pop_future$an==i] <- sum(pop_future_f_detail[56:109,as.character(i)])
    
    pop_future$h15_24[pop_future$an==i] <- sum(pop_future_h_detail[16:25,as.character(i)])
    pop_future$h25_54[pop_future$an==i] <- sum(pop_future_h_detail[26:55,as.character(i)])
    pop_future$h55_[pop_future$an==i] <- sum(pop_future_h_detail[56:109,as.character(i)])
  }
  return(pop_future)
}
pop_future <- import_detail()

View(pop_future)


```

## R Markdown

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:

```{r cars}
summary(cars)
```

## Including Plots

You can also embed plots, for example:

```{r pressure, echo=FALSE}
plot(pressure)
```

Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.
